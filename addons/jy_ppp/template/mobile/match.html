<html>
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="black" name="apple-mobile-web-app-status-bar-style" />
  <meta content="telephone=no" name="format-detection" />
  <title>{if !empty($sitem['aname'])}{$sitem['aname']}{else}有缘网{/if}</title>
  <link href="../addons/jy_ppp/css/public_reset.css" rel="stylesheet" type="text/css" />
  <link href="../addons/jy_ppp/css/public.css" rel="stylesheet" type="text/css" />
  <link href="../addons/jy_ppp/css/option_box.css" rel="stylesheet" type="text/css" />
  <link href="../addons/jy_ppp/css/user_setting.css" rel="stylesheet" type="text/css" />
 </head>
 <body>
  <div class="top_blank"></div>
  <nav class="nav" style="position: absolute;">
   <h2>择偶条件</h2>
   <div class="left" onclick="history.go(-1)">
    <i class="le_trg"></i>返回
   </div>
   <div class="right">
    <span id="save_btn" class="seach_sure">确定</span>
   </div>
  </nav>

<div class="content">
    <div class="option_box" style="margin-top: 10px">
        <div class="top">
          <h2>年龄范围</h2>
          <div class="new_select select_multiple J_selectMultiple">
              <div class="J_select select">
                <span class="title">
                    <span class="pink J_selected">
                    {if empty($match['age'])}
                        不限
                    {else}
                        {$match['age']}岁
                    {/if}
                    </span>
                <span class="value_select">
                    <select id="match_age" data-flage="岁"   class="J_selectItem value_select">
                       <option value="0" style="display:none">不限</option>
                        <?php for ($ageLoop=20; $ageLoop <= 50 ; $ageLoop++) {
                        ?> <option value="{$ageLoop}" {if $match['age']==$ageLoop} selected="selected" {/if}>{$ageLoop}岁 </option><?php
                    } ?>
                   </select>
                </span>
                </span>
              </div>
              <div class="range_flage">----</div>

              <div class="J_select select">
                <span class="title">
                    <span class="pink J_selected">
                    {if empty($match['agemax'])}
                        不限
                    {else}
                        {$match['agemax']}岁
                    {/if}
                    </span>
                <span class="value_select">
                    <select id="match_agemax" data-flage="岁" class="J_selectItem value_select">
                       <option value="0" style="display:none">不限</option>
                        <?php for ($agemaxLoop=20; $agemaxLoop <=50 ; $agemaxLoop++) {
                        ?> <option value="{$agemaxLoop}" {if $match['agemax']==$agemaxLoop} selected="selected" {/if}>{$agemaxLoop}岁 </option><?php
                    } ?>
                   </select>
                </span>
                </span>
              </div>
          </div>
      </div>
    </div>

   <div class="option_box" style="margin-top: 10px">
        <div class="top">
     <h2>身高范围</h2>
     <!--span class="unlimit"><span class="title pink">{if $match['height']==0}不限{/if}{if $match['height']==1}160cm以下{/if}{if $match['height']==2}161-165cm{/if}{if $match['height']==3}166-170cm{/if}{if $match['height']==4}170以上{/if}</span><i class="bot_trg"></i></span-->
        <!--div class="unlimit new_select"-->
        <div class="new_select select_multiple J_selectMultiple">
            <div class="J_select select">
                <span class="title">
                    <span class="pink J_selected">
                        {if empty($match['height'])}
                            不限
                        {else}
                            {$match['height']}cm
                        {/if}
                    </span>
                    <span class="value_select">
                        <!--<select id="match_height"  onchange="match_height_change(this.value)" class="J_selectItem value_select">-->
                        <select id="match_height" data-flage="cm" class="J_selectItem value_select">
                           <option value="0" style="display:none">不限</option>
                            <?php for ($i=140; $i <221 ; $i++) {
                            ?> <option value="{$i}" {if $match['height']==$i} selected="selected" {/if}>{$i}cm </option><?php
                        } ?>
                       </select>
                    </span>
                </span>
            </div>
            <div class="range_flage">----</div>
            <div class="J_select select">
                <span class="title">
                <span class="pink J_selected">
                    {if empty($match['heightmax'])}
                        不限
                    {else}
                        {$match['heightmax']}cm
                    {/if}
                </span>
                <span class="value_select">
                    <select id="match_heightmax" data-flage="cm"  class="J_selectItem value_select">
                       <option value="0" style="display:none">不限</option>
                        <?php for ($k=140; $k <221 ; $k++) {
                        ?> <option value="{$k}" {if $match['heightmax']==$k} selected="selected" {/if}>{$k}cm </option><?php
                    } ?>
                   </select>
                </span>
                </span>
            </div>
        </div>
    </div>
   </div>

   <div class="option_box" style="margin-top: 10px">
        <div class="top">
     <h2>最低学历</h2>
     <span class="unlimit"><span class="title pink" style="font-size: 14px;">{if $match['education']==0}不限{/if}{if $match['education']==1}大专及以上{/if}{if $match['education']==2}本科及以上{/if}{if $match['education']==3}硕士及以上{/if}</span><i class="bot_trg"></i></span>
    </div>
        <ul class="hidden" data-type="edu">
     <li> <span data-value="0" {if $match['education']==0}class="pink"{/if}>不限</span> <span data-value="1" {if $match['education']==1}class="pink"{/if}>中专及以上</span> </li>
     <li> <span data-value="2" {if $match['education']==2}class="pink"{/if}>大专及以上</span> <span data-value="3" {if $match['education']==3}class="pink"{/if}>本科及以上</span> </li>
     <li> <span data-value="4" {if $match['education']==4}class="pink"{/if}>硕士及以上</span> <span data-value="5" {if $match['education']==5}class="pink"{/if}>博士</span> </li>
    </ul>
   </div>

  <div class="option_box" style="margin-top: 10px">
      <div class="top">
          <h2>年收入范围</h2>
          <div class="new_select select_multiple J_selectMultiple">
              <div class="J_select select">
                <span class="title">
                    <span class="pink J_selected">
                        {if empty($match['income'])}
                            不限
                        {else}
                            {$match['income']}万
                        {/if}
                    </span>
                <span class="value_select">
                    <select id="match_income"  data-flage="万" class="J_selectItem value_select">
                       <option value="0" style="display:none">不限</option>
                        <?php for ($incomeLoop=0; $incomeLoop <= 100 ; $incomeLoop++) {
                        ?> <option value="{$incomeLoop}" {if $match['income']==$incomeLoop} selected="selected" {/if}>{$incomeLoop}万 </option><?php
                    } ?>
                   </select>
                </span>
                </span>
              </div>
              <div class="range_flage">----</div>
              <div class="J_select select">
                <span class="title">
                    <span class="pink J_selected">
                        {if empty($match['incomemax'])}
                            不限
                        {else}
                            {$match['incomemax']}万
                        {/if}
                    </span>
                <span class="value_select">
                    <select id="match_incomemax"  data-flage="万" class="J_selectItem value_select">
                       <option value="0" style="display:none">不限</option>
                        <?php for ($incomemaxLoop=0; $incomemaxLoop <=100 ; $incomemaxLoop++) {
                        ?> <option value="{$incomemaxLoop}" {if $match['incomemax']==$incomemaxLoop} selected="selected" {/if}>{$incomemaxLoop}万 </option><?php
                    } ?>
                   </select>
                </span>
                </span>
              </div>
          </div>
      </div>
  </div>

  <div class="option_box" style="margin-top: 10px">
    <div class="top">
     <h2>居住地</h2>
     <!--span class="unlimit"><span class="title pink" id="province" style="font-size: 14px;"></span><i class="bot_trg"></i></span-->
        <div id="live" class="right" style="display: inline-block;width: 60%;text-align: right;height: 22px;">
            <div class="select">
                <span class="value" id="province">
                </span>
                <i class="bot_trged"></i>
                <select id="live_province" class="value_select">
                </select>
            </div>
            <div class="select fixed_width">
                <span class="value" id="city">
                </span>
                <i class="bot_trged"></i>
                <select id="live_city" class="value_select">
                </select>
            </div>
        </div>
    </div>


    <!--ul class="four_list hidden" data-type="province" >
      <li>
        <span data-value="11" {if $province==11}class="pink"{/if} >北京市</span>
        <span data-value="12" {if $province==12}class="pink"{/if} >天津市</span>
        <span data-value="13" {if $province==13}class="pink"{/if} >河北省</span>
        <span data-value="14" {if $province==14}class="pink"{/if} >山西省</span>
      </li>
      <li>
        <span data-value="15" {if $province==15}class="pink"{/if} >内蒙古</span>
        <span data-value="21" {if $province==21}class="pink"{/if} >辽宁省</span>
        <span data-value="22" {if $province==22}class="pink"{/if} >吉林省</span>
        <span data-value="23" {if $province==23}class="pink"{/if} >黑龙江省</span>
      </li>
      <li>
        <span data-value="31" {if $province==31}class="pink"{/if} >上海市</span>
        <span data-value="32" {if $province==32}class="pink"{/if} >江苏省</span>
        <span data-value="33" {if $province==33}class="pink"{/if} >浙江省</span>
        <span data-value="34" {if $province==34}class="pink"{/if} >安徽省</span>
      </li>
      <li>
        <span data-value="35" {if $province==35}class="pink"{/if} >福建省</span>
        <span data-value="36" {if $province==36}class="pink"{/if} >江西省</span>
        <span data-value="37" {if $province==37}class="pink"{/if} >山东省</span>
        <span data-value="41" {if $province==41}class="pink"{/if} >河南省</span>
      </li>
      <li>
        <span data-value="42" {if $province==42}class="pink"{/if} >湖北省</span>
        <span data-value="43" {if $province==43}class="pink"{/if} >湖南省</span>
        <span data-value="44" {if $province==44}class="pink"{/if} >广东省</span>
        <span data-value="45" {if $province==45}class="pink"{/if} >广西</span>
      </li>
      <li>
        <span data-value="46" {if $province==46}class="pink"{/if} >海南省</span>
        <span data-value="50" {if $province==50}class="pink"{/if} >重庆市</span>
        <span data-value="51" {if $province==51}class="pink"{/if} >四川省</span>
        <span data-value="52" {if $province==52}class="pink"{/if} >贵州省</span>
      </li>
      <li>
        <span data-value="53" {if $province==53}class="pink"{/if} >云南省</span>
        <span data-value="54" {if $province==54}class="pink"{/if} >西藏</span>
        <span data-value="61" {if $province==61}class="pink"{/if} >陕西省</span>
        <span data-value="62" {if $province==62}class="pink"{/if} >甘肃省</span>
      </li>
      <li>
        <span data-value="63" {if $province==63}class="pink"{/if} >青海省</span>
        <span data-value="64" {if $province==64}class="pink"{/if} >宁夏</span>
        <span data-value="65" {if $province==65}class="pink"{/if} >新疆</span>
        <span data-value="71" {if $province==71}class="pink"{/if} >台湾省</span>
      </li>
      <li>
        <span data-value="81" {if $province==81}class="pink"{/if} >香港</span>
        <span data-value="82" {if $province==82}class="pink"{/if} >澳门</span><span></span><span></span> </li>
    </ul-->
   </div>

</div>
  <!--<input type="hidden" id="con_age" value="{$match['age']}" />-->
  <!--<input type="hidden" id="con_agemax" value="{$match['agemax']}" />-->
  <input type="hidden" id="con_age" value="{$match['age']},{$match['agemax']}">
  <input type="hidden" id="con_height"  value="{$match['height']},{$match['heightmax']}"/>
  <!--<input type="hidden" id="con_height"  value="{$match['height']}"/>-->
  <!--<input type="hidden" id="con_heightmax"  value="{$match['heightmax']}"/>-->
  <input type="hidden" id="con_income" value="{$match['income']},{$match['incomemax']}" />
  <!--<input type="hidden" id="con_incomemax" value="{$match['incomemax']}" />-->
  <input type="hidden" id="con_province" value="{$province}" />
  <input type="hidden" id="con_edu" value="{$match['education']}" />
  <input type="hidden" id="con_girlCareId" value="" />

  <script src="../addons/jy_ppp/js/zepto.min.js"></script>
  <script src="../addons/jy_ppp/js/public.js"></script>
  <script src="../addons/jy_ppp/js/waiting.js"></script>
  <script src="../addons/jy_ppp/js/set_match.js"></script>
  <script src="../addons/jy_ppp/js/area_id.js"></script>

  <script type="text/javascript">

$(function () {
    $("#province").html(area_array[{$member['province']}]);
    $("#city").html(sub_array[{$member['province']}][{$member['city']}]);
    $("#live_province").empty();
    {if empty($member['province'])}
    for(var i in area_array){
        $("#live_province").append('<option value="'+ i+'">'+ area_array[i]+'</option>');
    }
    {else}
    for(var i in area_array){
        if({$member['province']}==i)
        {
            $("#live_province").append('<option value="'+ i+'" selected>'+ area_array[i]+'</option>');
        }
        else
        {
            $("#live_province").append('<option value="'+ i+'">'+ area_array[i]+'</option>');
        }
    }
    {/if}

    $("#live_city").empty();
    {if empty($member['city'])}
    for(var i in sub_array[{$member['province']}]){
        $("#live_city").append('<option value="'+ i+'">'+ sub_array[{$member['province']}][i]+'</option>');
    }
    {else}
    for(var i in sub_array[{$member['province']}]){
        if({$member['city']}==i)
        {
            $("#live_city").append('<option value="'+ i+'" selected>'+ sub_array[{$member['province']}][i]+'</option>');
        }
        else
        {
            $("#live_city").append('<option value="'+ i+'">'+ sub_array[{$member['province']}][i]+'</option>');
        }
    }
    {/if}


});



$("#save_btn").bind("click",function(){
    var con_ageVal=$("#con_age").val().split(',')[0];
    var con_agemaxVal=$("#con_age").val().split(',')[1];
    var con_heightVal=$("#con_height").val().split(',')[0];
    var con_heightmaxVal=$("#con_height").val().split(',')[1];
    var con_incomeVal=$("#con_income").val().split(',')[0];
    var con_incomemaxVal=$("#con_income").val().split(',')[1];
    var con_provinceVal=$("#con_province").val();
    var con_eduVal=$("#con_edu").val();
    var con_girlCareIdVal=$("#con_girlCareId").val();

    if (con_heightVal > con_heightmaxVal) {
        alert("亲，身高的下拉框范围选择错误");
    }
    var param = {con_age: con_ageVal, con_agemax: con_agemaxVal, con_height:con_heightVal, con_heightmax:con_heightmaxVal, con_income:con_incomeVal, con_incomemax:con_incomemaxVal, con_province:con_provinceVal, con_edu:con_eduVal, con_girlCareId:con_girlCareIdVal };

    // ajax-----
    $.ajax({url: "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('match',array('op'=>'add')),2);}", data: param, dataType: 'text', type: 'post', success: function (data) {
        if (data==1) {
            $.tips("保存成功");
            location.href="{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('geren'),2)}"
        }
        else
        {
          $.tips("网络异常，请稍后再试");
        }
    }, error: function () {
        $.tips("网络异常，请稍后再试");
    }
    });
});
$(".top").bind("click",function(event){
  // if(event.target == this){
    Match.toggle($(this));
  // }
});
$("[data-value]").bind("click",function(){
  var $this = $(this),type=$this.closest("[data-type]").data("type"),value=$this.data('value');

    if(type=='age'){
        Match.changeAge(value);
    }else if(type=='height'){
        Match.changeHeight(value);
    }else if(type=='edu'){
        Match.changeEducation(value);
    }else if(type=='salary'){
        Match.changeSalary(value);
    }else if(type=='province'){
        Match.changeProvince(value);
    }else if(type=='girlCare'){
        Match.changeInterest(value)
    }
    Match.changeEvent($this);
});

function formatVal(ele){

    var _value = $(ele).val();
    var _array = [];
    _array.push(_value);
    var J_sibling = $(ele).closest('.J_select').siblings('.J_select');
    var _sibVal = J_sibling.find('.J_selectItem').val();
    _array.push(_sibVal);
    var _valStr = Math.min.apply(null,_array) + ',' +  Math.max.apply(null,_array);
    return _valStr;
}

$('.J_selectItem').on('change',function (e) {
    var _value = $(e.currentTarget).val();
    var _unit  = $(e.currentTarget).attr('data-flage');

    var J_value = $(e.currentTarget).closest('.J_select').find('.J_selected');

    switch(_unit){
        case '岁':
            $('#con_age').val(formatVal(e.currentTarget));
            break;
        case 'cm':
            $('#con_height').val(formatVal(e.currentTarget));
            break;
        case '万':
            $('#con_income').val(formatVal(e.currentTarget));
            break;
    }

    if(_unit == '万' && !Number(_value)){
        _value = '不限';
        _unit = '';
    }

    J_value.html(_value + _unit);
})




  </script>

{template 'inc/footer'}
 </body>
</html>